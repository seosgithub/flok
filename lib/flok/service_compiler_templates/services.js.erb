<% @config.service_instances.each do |si| %>
  "hello";
<% end %>

<% @services.each do |s| %>
  //Start of <%= s.name %> on_wakeup
  function <%= s.name %>_on_wakeup() {
    //The timer base pointer for incomming callout events
    <%= s.name %>_timer_bp = tels(1);
    reg_evt(<%= s.name %>_timer_bp, <%= s.name %>_handle_timer_events);

    //Tell the timer to notify our timer event handlers
    //The name is randomly generated for each one
    <% s.every_handlers.each do |h| %>
        reg_interval(<%= s.name %>_timer_bp, '<%= h[:name] %>', <%= h[:ticks] %>);
    <% end %>
  }

  function <%= s.name %>_on_sleep() {
    <%= s._on_sleep %>
  }

  function <%= s.name %>_on_connect(bp) {
    <%= s._on_connect %>
  }

  function <%= s.name %>_on_disconnect(bp) {
    <%= s._on_disconnect %>
  }
  
  //'Event' handlers
  <% s.event_handlers.each do |h| %>
    function <%= s.name %>_on_<%= h[:name] %>(bp, params) {
      <%= h[:str] %>
    }
  <% end %>

  //Timer receivers
  /////////////////////////////////////////////////////////////////////
  function <%= s.name %>_handle_timer_events(ep, ename, info) {
    <% s.every_handlers.each do |h| %>
        if (ename === '<%= h[:name] %>') {
          <%= h[:str] %>
        }
    <% end %>
  }
  /////////////////////////////////////////////////////////////////////
<% end %>
